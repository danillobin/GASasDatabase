class GappsDapi{constructor(e=""){this.base=this.getBase(e)||this.createBase(e)}createBase(e){let t={method:"POST",contentType:"application/json",payload:JSON.stringify({mimeType:"application/vnd.google-apps.folder",name:e}),headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}};return JSON.parse(UrlFetchApp.fetch("https://www.googleapis.com/drive/v3/files/",t).getContentText())}getBase(e){const t=`https://www.googleapis.com/drive/v3/files/?q=name='${e}' and trashed=false and mimeType = 'application/vnd.google-apps.folder'`,o={method:"GET",headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}};return JSON.parse(UrlFetchApp.fetch(t,o).getContentText()).files[0]}deleteBase(e=this.base.id){const t=`https://www.googleapis.com/drive/v3/files/${e}`,o={method:"DELETE",headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}};UrlFetchApp.fetch(t,o).getContentText()}findPosts(e=[],t=20){let o="";return e.forEach((function(t,a){let r="";r+=`fullText contains '%22${function(e){let t="";return Object.entries(e).forEach((([e,o])=>t+=`${e}:${o}`)),t}(t)}%22'`,e.length>1?o+=a+1!=e.length?`(${r}) or `:`(${r})`:o=r})),o=`and (${o})`,this.getPosts(t,o)}getPosts(e=20,t=""){const o=`https://www.googleapis.com/drive/v3/files/?pageSize=${e}&${t?"":"orderBy=createdTime&"}q='${this.base.id}' in parents and trashed=false ${t}`,a={method:"GET",headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}};return JSON.parse(UrlFetchApp.fetch(o,a).getContentText()).files}getValuePosts(e){let t={};return e.forEach((function(e){const o=`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,a={method:"GET",headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}},r=UrlFetchApp.fetch(o,a).getContentText();t[e]=JSON.parse(r)})),t}createPost(e=""){const t=Utilities.base64Encode((new Date).valueOf())+(o=1e5,a=999999,o=Math.ceil(o),a=Math.floor(a),Math.floor(Math.random()*(a-o))+o);var o,a;const r={contentType:"application/json",method:"POST",payload:JSON.stringify({mimeType:"text/plain",parents:[this.base.id],name:t}),headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}},s=JSON.parse(UrlFetchApp.fetch("https://www.googleapis.com/drive/v3/files/",r).getContentText());return e?this.editPost(s.id,e):s}deletePost(e){this.fetch(`https://www.googleapis.com/drive/v3/files/${e}`,"DELETE")}editPost(e,t=""){const o=`https://www.googleapis.com/upload/drive/v3/files/${e}`,a={method:"PATCH",contentType:"text/plain",payload:JSON.stringify(t),headers:{Authorization:`Bearer ${ScriptApp.getOAuthToken()}`}};return JSON.parse(UrlFetchApp.fetch(o,a).getContentText())}}
