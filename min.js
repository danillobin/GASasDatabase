(class GASDasDatabase{constructor(e){this.folder=DriveApp.getFoldersByName(e),this.folder.hasNext()?this.folder=this.folder.next():this.folder=DriveApp.createFolder(e)}clearBase(){let e=this.folder.getFiles();for(;e.hasNext();)e.next().setTrashed(!0)}deleteBase(){this.folder.setTrashed(!0);for(const[e,t]of Object.entries(this))delete this[e]}getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}dataToObject(e,t,s){let r={};return r.id=t,r.post=e,r.value=s,r}createPost(e="",t="",s=MimeType.PLAIN_TEXT){e=JSON.stringify(e),t=t||Utilities.base64Encode((new Date).valueOf())+this.getRandomInt(1e5,999999);let r=this.folder.createFile(t,e,s);return this.dataToObject(r,t,this.getValue(r))}deletePost(e){return e.setTrashed(!0)}searchPosts(e="",t=20,s=0){if(isNaN(t)||isNaN(s))return[];let r;r=e?this.folder.searchFiles(e):this.folder.getFiles();let a=[],l=0;for(;r.hasNext();){l++;let e=r.next();if(l<=s)continue;let i=this.dataToObject(e,e.getName(),this.getValue(e));if(new Date(e.getDateCreated()).valueOf()>new Date(a[0]?.getDateCreated?.()).valueOf()?a.unshift(i):a.splice(1,0,i),a.length>=t&&0!=t)break}return a}getValue(e){let t=e.getBlob().getDataAsString();return t&&(t=JSON.parse(t)),t}setValue(e,t){return e=JSON.stringify(e),t.setContent(e)}getPosts(e=[],t=20,s=0){let r="";return e.forEach((function(t,s){let a="";for(const[e,s]of Object.entries(t)){let t=`fullText contains '"${e}":${s}'`;a+=a?" and "+t:t}e.length>1?r+=s+1!=e.length?`(${a}) or `:`(${a})`:r=a})),this.searchPosts(r,t,s)}})
